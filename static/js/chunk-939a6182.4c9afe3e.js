(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-939a6182"],{"6dc3":function(e,t,i){},"789c":function(e,t,i){"use strict";i.d(t,"f",(function(){return l})),i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"b",(function(){return o})),i.d(t,"e",(function(){return s})),i.d(t,"d",(function(){return c}));var a=i("b775");function l(e){return Object(a["a"])({url:"/file/upload",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})}function n(e){return Object(a["a"])({url:"/file/download/".concat(e),method:"get"})}function r(e){return Object(a["a"])({url:"/file/page",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/file/edit/state",method:"put",data:e})}function s(e){return Object(a["a"])({url:"/file/remove/".concat(e),method:"delete"})}function c(e){return Object(a["a"])({url:"/file/remove/batch",method:"delete",data:e})}},ac5a:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:2.5}},[i("el-button",{attrs:{type:"danger"},on:{click:e.handleDeleteBatch}},[e._v(" "+e._s(e.$t("permission.deleteBatch"))+" ")])],1),i("el-col",{attrs:{span:2.5}},[i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.uploadAction,"before-upload":e.submitUpload,"on-change":e.markUploadFile,accept:".xls,.xlsx,.doc,.docx,.pdf,.txt,.jpg,.png,.gif,.rar,.zip,.arj,.mp4,.avi,.mp3,.wav,.ogg,.wma,.flac",multiple:""}},[i("el-button",{attrs:{type:"primary"}},[e._v("文件上传")])],1)],1),i("el-col",{attrs:{span:4}},[i("el-input",{attrs:{placeholder:"根据文件名搜索",clearable:""},on:{clear:e.getFilePage},model:{value:e.queryInfo.relName,callback:function(t){e.$set(e.queryInfo,"relName",t)},expression:"queryInfo.relName"}})],1),i("el-col",{attrs:{span:3}},[i("el-select",{attrs:{placeholder:"根据文件类型搜索",clearable:""},on:{clear:e.getFilePage},model:{value:e.queryInfo.fileType,callback:function(t){e.$set(e.queryInfo,"fileType",t)},expression:"queryInfo.fileType"}},e._l(e.fileTypes,(function(e){return i("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})})),1)],1),i("el-col",{attrs:{span:3}},[i("el-select",{attrs:{placeholder:"根据文件状态搜索",clearable:""},on:{clear:e.getFilePage},model:{value:e.queryInfo.state,callback:function(t){e.$set(e.queryInfo,"state",t)},expression:"queryInfo.state"}},e._l(e.states,(function(e){return i("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})})),1)],1),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary"},on:{click:e.getFilePage}},[e._v("搜索")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.fileList,border:""},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{align:"center",type:"selection",width:"50px"}}),i("el-table-column",{attrs:{align:"center",label:"编号",type:"index",index:e.tableIndex,width:"55px"}}),i("el-table-column",{attrs:{align:"center",label:"文件名",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.relName)+" ")]}}])}),i("el-table-column",{attrs:{align:"center",label:"上传用户"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.nickname)+" ")]}}])}),i("el-table-column",{attrs:{align:"center",label:"上传时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e._f("parseTime")(t.row.createTime,"{y}-{m}-{d} {h}:{i}")))])]}}])}),i("el-table-column",{attrs:{align:"center",label:"文件类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.fileTypes[t.row.fileType-1].display_name)+" ")]}}])}),i("el-table-column",{attrs:{align:"center",label:"文件大小"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getFileSize(t.row.fileSize))+" ")]}}])}),i("el-table-column",{attrs:{align:"center",label:"缩略图"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("img",{directives:[{name:"show",rawName:"v-show",value:t.row.thumbnailUrl&&4!==t.row.fileType,expression:"scope.row.thumbnailUrl && scope.row.fileType !== 4"}],staticClass:"thumbnail",attrs:{src:t.row.thumbnailUrl},on:{click:function(i){return e.openPreviewThumbnailDialog(t.row.thumbnailUrl)}}})]}}])}),i("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-value":0,"inactive-value":1},on:{change:function(i){return e.editStatus(i,t.row.id,t.row.state)}},model:{value:t.row.state,callback:function(i){e.$set(t.row,"state",i)},expression:"scope.row.state"}})]}}])}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(i){return e.downloadFile(t.row.id)}}},[e._v("下载")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return e.handleDetails(t)}}},[e._v(" "+e._s(e.$t("permission.details"))+" ")]),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){return e.handleDelete(t)}}},[e._v(" "+e._s(e.$t("permission.delete"))+" ")])]}}])})],1),i("el-pagination",{attrs:{"current-page":e.queryInfo.page,"page-sizes":[10,20,50,100],"page-size":e.queryInfo.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pageInfo.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),i("el-dialog",{attrs:{visible:e.dialogVisible,title:"详情"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{model:e.file,"label-width":"100px","label-position":"left"}},[i("el-form-item",{attrs:{label:"文件名",prop:"relName"}},[i("el-input",{attrs:{readonly:!0},model:{value:e.file.relName,callback:function(t){e.$set(e.file,"relName",t)},expression:"file.relName"}})],1),i("el-form-item",{attrs:{label:"上传用户",prop:"nickname"}},[i("el-input",{attrs:{readonly:!0},model:{value:e.file.nickname,callback:function(t){e.$set(e.file,"nickname",t)},expression:"file.nickname"}})],1),i("el-form-item",{attrs:{label:"文件类型",prop:"fileType"}},[i("el-input",{attrs:{readonly:!0},model:{value:e.fileType,callback:function(t){e.fileType=t},expression:"fileType"}})],1),i("el-form-item",{attrs:{label:"文件大小",prop:"fileSize"}},[i("el-input",{attrs:{readonly:!0},model:{value:e.fileSize,callback:function(t){e.fileSize=t},expression:"fileSize"}})],1),i("el-form-item",{attrs:{label:"文件状态",prop:"state"}},[i("el-input",{attrs:{readonly:!0},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}})],1),i("el-form-item",{attrs:{label:"文件内容",prop:"avatar"}},[1==e.file.fileType?i("img",{staticClass:"avatar",attrs:{src:e.file.url},on:{click:function(t){return e.openPreviewImageDialog(e.file.url)}}}):e._e(),2==e.file.fileType?i("div",{staticClass:"video-container",on:{click:function(t){return e.openPreviewVideoDialog(e.file.url)}}},[i("video",{ref:"videoPlayer",staticClass:"video-preview",attrs:{src:e.file.url,muted:"",preload:"metadata"},domProps:{muted:!0},on:{mouseenter:e.playPreview,mouseleave:e.pausePreview}})]):e._e(),3==e.file.fileType?i("audio",{ref:"audioPlayer",attrs:{src:e.file.url,controls:""}}):e._e(),4==e.file.fileType?i("div",[e.file.thumbnailUrl?i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.textPreview(e.file.url,e.file.thumbnailUrl)}}},[e._v("点击查看")]):i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.downloadFile(e.file.id)}}},[e._v("下载查看")])],1):e._e()])],1)],1),i("el-dialog",{attrs:{visible:e.previewThumbnailDialogVisible,width:"500px",height:"500px"},on:{"update:visible":function(t){e.previewThumbnailDialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.previewThumbnailUrl,alt:""}})]),i("el-dialog",{attrs:{visible:e.previewImageDialogVisible},on:{"update:visible":function(t){e.previewImageDialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.previewImageUrl,alt:"",autoplay:"",loop:""}})]),i("el-dialog",{attrs:{visible:e.previewVideoDialogVisible},on:{"update:visible":function(t){e.previewVideoDialogVisible=t},close:e.closeVideoModal}},[i("div",{staticClass:"video-modal-content"},[i("NPlayer",{ref:"player",attrs:{options:{src:e.previewVideoUrl,contextMenus:["loop","pip"],volumeVertical:!0,volumeProgressBg:"skyblue"},set:e.setPlayer}})],1)]),i("el-dialog",{attrs:{visible:e.previewTextDialogVisible},on:{"update:visible":function(t){e.previewTextDialogVisible=t}}},[i("iframe",{attrs:{src:""+e.previewTextPDFUrl,width:"100%",height:"800px",frameborder:"0"}})])],1)},l=[],n=i("c7eb"),r=i("1da1"),o=(i("b680"),i("b0c0"),i("d3b7"),i("ac1f"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("d81d"),i("ed08")),s=i("789c"),c={name:"File",data:function(){return{loading:!1,fileList:[],pageInfo:{page:1,size:10,total:0,pages:0},queryInfo:{fileType:null,relName:null,state:null,page:1,size:10},file:{url:"",nickname:"",fileType:"",fileSize:"",relName:"",state:""},dialogVisible:!1,fileType:"",fileSize:"",state:"",fileTypes:[{key:"1",display_name:"图片"},{key:"2",display_name:"视频"},{key:"3",display_name:"音频"},{key:"4",display_name:"文本"}],states:[{key:"0",display_name:"可使用"},{key:"1",display_name:"已禁用"}],uploadNums:0,multipleSelection:[],previewThumbnailDialogVisible:!1,previewThumbnailUrl:"",previewImageDialogVisible:!1,previewImageUrl:"",previewVideoDialogVisible:!1,previewVideoUrl:"",player:null,previewTextDialogVisible:!1,previewTextUrl:"",previewTextPDFUrl:""}},computed:{uploadAction:function(){return"javascript:void(0)"}},created:function(){this.getFilePage()},methods:{getFilePage:function(){var e=this;return Object(r["a"])(Object(n["a"])().mark((function t(){var i;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(s["c"])(e.queryInfo);case 3:i=t.sent,e.fileList=i.data.list,e.pageInfo=i.data.pageInfo,e.loading=!1;case 7:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.queryInfo.size=e,this.getFilePage()},handleCurrentChange:function(e){this.queryInfo.page=e,this.getFilePage()},tableIndex:function(e){return(this.queryInfo.page-1)*this.queryInfo.size+e+1},getFileSize:function(e){var t=(e/1048576).toFixed(2);return t>1024?t=t/1024+" GB":t<.9?t=1024*t+" KB":t+=" MB",t},submitUpload:function(e){var t=this,i=this.getFileType(e);if(i){this.loading=!0;var a=new FormData;a.append("file",e),a.append("type",i),Object(s["f"])(a).then((function(e){200===e.code?(t.uploadNums=t.uploadNums-1,0===t.uploadNums&&(t.loading=!1,t.getFilePage(),t.$message.success("上传成功"))):(t.loading=!1,t.$message.error("上传失败"))}))}return!1},markUploadFile:function(e){0===this.uploadNums&&this.$message.success("上传中..."),this.uploadNums=this.uploadNums+1},getFileType:function(e){var t="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type||"image/gif"===e.type;if(t)return 1;var i="video/mp4"===e.type||"video/adv"===e.type;if(i)return 2;var a="audio/mp3"===e.type||"audio/wav"===e.type||"audio/wma"===e.type||"audio/ogg"===e.type||"audio/flac"===e.type;if(a)return 3;var l="application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||"application/msword"===e.type||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e.type||"application/pdf"===e.type||"text/plain"===e.type||""===e.type;if(l)return 4;t||i||a||l||this.$message.error(e.name+"上传文件格式不支持！")},downloadFile:function(e){var t=this;return Object(r["a"])(Object(n["a"])().mark((function i(){return Object(n["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Object(s["a"])(e).then((function(e){fetch(e.headers["custom-header"]).then((function(t){var i=/filename="(.+)"/.exec(e.headers["content-disposition"]),a=i?i[1]:"downloaded_file",l=decodeURIComponent(a);return t.blob().then((function(e){var t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=l,i.style.display="none",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(t),document.body.appendChild(i)}))}))}));case 3:i.next=9;break;case 5:i.prev=5,i.t0=i["catch"](0),console.error("下载失败:",i.t0),t.$message.error("下载失败");case 9:case"end":return i.stop()}}),i,null,[[0,5]])})))()},editStatus:function(e,t){return Object(r["a"])(Object(n["a"])().mark((function i(){var a;return Object(n["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a={id:t,state:e},i.next=3,Object(s["b"])(a);case 3:case"end":return i.stop()}}),i)})))()},handleDetails:function(e){var t=this;return Object(r["a"])(Object(n["a"])().mark((function i(){return Object(n["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.dialogVisible=!0,t.file=Object(o["c"])(e.row),t.getTypeName(t.file.fileType),t.getStateName(t.file.state),t.fileSize=t.getFileSize(t.file.fileSize);case 5:case"end":return i.stop()}}),i)})))()},getTypeName:function(e){1===e&&(this.fileType="图片"),2===e&&(this.fileType="视频"),3===e&&(this.fileType="音频"),4===e&&(this.fileType="文本")},getStateName:function(e){0===e&&(this.state="可使用"),1===e&&(this.state="已禁用")},openPreviewThumbnailDialog:function(e){this.previewThumbnailUrl=e,this.previewThumbnailDialogVisible=!0},openPreviewImageDialog:function(e){this.previewImageUrl=e+"?+".concat((new Date).getTime()),this.previewImageDialogVisible=!0},openPreviewVideoDialog:function(e){this.player&&this.previewVideoUrl!==e&&(this.player.video.src=e),this.previewVideoUrl=e,this.previewVideoDialogVisible=!0},playPreview:function(){var e=this.$refs.videoPlayer;e.play()},pausePreview:function(){var e=this.$refs.videoPlayer;e.pause()},closeVideoModal:function(){this.player&&this.player.pause()},setPlayer:function(e){this.player=e},textPreview:function(e,t){this.previewTextUrl=e,this.previewTextPDFUrl=t,this.previewTextDialogVisible=!0},handleSelectionChange:function(e){this.multipleSelection=e.map((function(e){return e.id}))},handleDeleteBatch:function(){var e=this;this.$confirm("确定要批量删除文件吗？","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(Object(n["a"])().mark((function t(){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.multipleSelection.length>0)){t.next=7;break}return e.loading=!0,e.$message.success("删除中..."),t.next=5,Object(s["d"])(e.multipleSelection).then((function(t){200===t.code?(e.loading=!1,e.getFilePage(),e.$message.success("删除成功")):(e.loading=!1,e.$message.error("删除失败，请检查后重试"))}));case 5:t.next=8;break;case 7:e.$message.error("请选择删除的文件！");case 8:case"end":return t.stop()}}),t)}))))},handleDelete:function(e){var t=this,i=e.row;this.$confirm("确定要删除文件吗？","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["e"])(i.id).then((function(e){200===e.code?(t.getFilePage(),t.$message.success("删除成功")):t.$message.error("删除失败，请检查后重试")}));case 2:case"end":return e.stop()}}),e)}))))}}},u=c,p=(i("da83"),i("2877")),d=Object(p["a"])(u,a,l,!1,null,"0dc12ccb",null);t["default"]=d.exports},da83:function(e,t,i){"use strict";i("6dc3")}}]);